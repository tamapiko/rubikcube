<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ルービックキューブ色スキャナー</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f5f5f5; }
    video { width: 300px; border: 2px solid #333; }
    button { margin-top: 10px; padding: 10px 20px; font-size: 16px; }
    pre { background: #eee; padding: 10px; text-align: left; display: inline-block; }
  </style>
</head>
<body>
  <h1>ルービックキューブ面スキャナー</h1>
  <video id="video" autoplay></video><br>
  <button onclick="capture()">この面を読み取る</button>
  <canvas id="canvas" style="display:none;"></canvas>
  <h3>読み取り結果</h3>
  <pre id="output"></pre>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const output = document.getElementById('output');

    // カメラ起動
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => { video.srcObject = stream; })
      .catch(err => alert("カメラにアクセスできません：" + err));

    function capture() {
      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);

      const colors = [];
      for (let row = 0; row < 3; row++) {
        for (let col = 0; col < 3; col++) {
          const x = canvas.width * (0.35 + 0.1 * col);
          const y = canvas.height * (0.35 + 0.1 * row);
          const pixel = ctx.getImageData(x, y, 1, 1).data;
          const label = classifyColor({ r: pixel[0], g: pixel[1], b: pixel[2] });
          colors.push(label);
        }
      }

      output.textContent += `面: ${colors.join(' ')}\n`;
    }

    function classifyColor({ r, g, b }) {
      if (r > 200 && g > 200 && b > 200) return 'W'; // 白
      if (r > 180 && g < 80 && b < 80) return 'R';   // 赤
      if (r < 80 && g > 180 && b < 80) return 'G';   // 緑
      if (r < 80 && g < 80 && b > 180) return 'B';   // 青
      if (r > 200 && g > 200 && b < 100) return 'Y'; // 黄
      if (r > 200 && g > 130 && b < 80) return 'O';  // オレンジ
      return '?'; // 判別不能
    }
  </script>
</body>
</html>
